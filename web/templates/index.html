<html>
  <head>
    <title>Welcome to the WWW 2006!</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <script>

      var ws;

      function connect() {

        // Connect to the websocket
        if (window["WebSocket"]) {
            console.log('We have WebSockets available');
            let socketUrl = "ws://" + document.location.host + "/ws"
            console.log(socketUrl);
            ws = new WebSocket(socketUrl);

            ws.onopen = function (e) {
              console.log('Connection opened');
            };

            ws.onclose = function (e) {
              console.log('Connection closed');
            };

            ws.onmessage = function (e) {
              //var msg = JSON.parse(e.data);
              console.log(`Received message ${e.data}`);
            };
        } else {
          console.log('Your browser does not support WebSockets.');
        }
      }

      function handleMouseMove(event) {
           var eventDoc, doc, body;
           event = event || window.event;

           var msg = {x: event.pageX, y: event.pageY};
           if (!ws) {
             console.log('No connection!');
             return false;
          }
          //console.log('Sending message', msg);
          //ws.send(JSON.stringify({ Num: parseInt($("#numberfield").val()) }));
          //conn.send(JSON.stringify(msg));
          //console.log(ws.readyState);
          let payload = JSON.stringify(msg);
          console.log(payload);

          ws.send(payload);
          //ws.send(msg);
       }

      $().ready(function () {
        connect();
        document.onmousemove = handleMouseMove;
      });
    </script>
  </head>
  <body>
    <h1>Hello WWW 2006</h1>
    <h2>This page has had <span id="visitor-counter">{{.VisitorCount}}</span> visitors</h2>
  </body>
<html>
